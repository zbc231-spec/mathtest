<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœ€ç°¡å–®æ•´æ•¸æ¯”ç·´ç¿’</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full flex items-center justify-center p-4">
  <div class="w-full max-w-2xl"><!-- å­¸ç”Ÿè³‡è¨Šè¼¸å…¥é é¢ -->
   <div id="info-page" class="p-8 rounded-2xl shadow-xl">
    <div class="text-center mb-8">
     <div class="flex items-center justify-center gap-3 mb-4"><span class="text-5xl">ğŸ“Š</span>
      <h1 id="app-title" class="text-4xl font-bold">æœ€ç°¡å–®æ•´æ•¸æ¯”ç·´ç¿’</h1><span class="text-5xl">ğŸ”¢</span>
     </div>
     <div id="date-display" class="inline-block px-6 py-3 rounded-lg text-xl font-semibold"></div>
    </div>
    <div class="space-y-6">
     <div><label for="grade-input" id="grade-label" class="flex items-center gap-2 text-lg font-medium mb-2"> <span>ğŸ“</span> <span>å¹´ç´š</span> </label> <input type="number" id="grade-input" min="1" max="6" class="w-full px-4 py-3 rounded-lg border-2 text-lg" placeholder="5å¹´ç´šè«‹å¡«5,6å¹´ç´šè«‹å¡«6">
     </div>
     <div><label for="class-input" id="class-label" class="flex items-center gap-2 text-lg font-medium mb-2"> <span>ğŸ«</span> <span>ç­ç´š</span> </label> <input type="number" id="class-input" min="1" class="w-full px-4 py-3 rounded-lg border-2 text-lg" placeholder="1ç­è«‹å¡«1,2ç­è«‹å¡«2,ä¾æ­¤é¡æ¨">
     </div>
     <div><label for="seat-input" id="seat-label" class="flex items-center gap-2 text-lg font-medium mb-2"> <span>ğŸ‘¤</span> <span>åº§è™Ÿ</span> </label> <input type="number" id="seat-input" min="1" class="w-full px-4 py-3 rounded-lg border-2 text-lg" placeholder="1è™Ÿè«‹å¡«1,2è™Ÿè«‹å¡«2,ä¾æ­¤é¡æ¨">
     </div><button id="start-btn" class="w-full py-4 rounded-lg text-xl font-bold transition-all duration-200 flex items-center justify-center gap-2"> <span>âœï¸</span> <span>é–‹å§‹ç·´ç¿’</span> </button>
    </div>
   </div><!-- ç­”é¡Œé é¢ -->
   <div id="question-page" class="hidden p-8 rounded-2xl shadow-xl">
    <div class="mb-6">
     <div class="flex justify-between items-center mb-4"><span id="progress" class="text-xl font-semibold flex items-center gap-2"> <span>ğŸ“</span> <span id="progress-text"></span> </span> <span id="student-info" class="text-lg flex items-center gap-2"> <span>ğŸ‘¨â€ğŸ“</span> <span id="student-info-text"></span> </span>
     </div>
     <div class="w-full h-3 rounded-full overflow-hidden">
      <div id="progress-bar" class="h-full transition-all duration-300"></div>
     </div>
    </div>
    <div id="question-container" class="mb-8 p-6 rounded-xl">
     <p class="text-2xl font-semibold mb-6" id="question-text"></p>
     <div class="flex items-center gap-4"><input type="number" id="answer1" class="flex-1 px-4 py-3 rounded-lg border-2 text-xl text-center" placeholder="ç¬¬ä¸€å€‹æ•¸"> <span class="text-3xl font-bold">:</span> <input type="number" id="answer2" class="flex-1 px-4 py-3 rounded-lg border-2 text-xl text-center" placeholder="ç¬¬äºŒå€‹æ•¸">
     </div>
    </div><button id="submit-btn" class="w-full py-4 rounded-lg text-xl font-bold transition-all duration-200">æäº¤ç­”æ¡ˆ</button>
   </div><!-- çµæœé é¢ -->
   <div id="result-page" class="hidden p-8 rounded-2xl shadow-xl">
    <div class="text-center mb-8">
     <div class="text-6xl mb-4">
      ğŸ‰
     </div>
     <h2 class="text-4xl font-bold mb-4">ç·´ç¿’å®Œæˆ!</h2>
     <div id="score-display" class="text-6xl font-bold mb-6"></div>
     <p class="text-2xl flex items-center justify-center gap-2"><span>ğŸ†</span> <span>ä½ çš„æˆç¸¾</span></p>
    </div>
    <div id="answers-review" class="space-y-4 mb-8"></div><button id="restart-btn" class="w-full py-4 rounded-lg text-xl font-bold transition-all duration-200 flex items-center justify-center gap-2"> <span>ğŸ”„</span> <span>é‡æ–°é–‹å§‹</span> </button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#e0f2fe",
      surface_color: "#fef3c7",
      text_color: "#1e293b",
      primary_action_color: "#f59e0b",
      secondary_action_color: "#06b6d4",
      app_title: "æœ€ç°¡å–®æ•´æ•¸æ¯”ç·´ç¿’",
      date_label: "ä»Šæ—¥æ—¥æœŸ",
      grade_label: "å¹´ç´š",
      class_label: "ç­ç´š",
      seat_label: "åº§è™Ÿ",
      button_text: "é–‹å§‹ç·´ç¿’",
      font_family: "system-ui",
      font_size: 16
    };

    let config = { ...defaultConfig };
    let currentQuestion = 0;
    let studentInfo = {};
    let userAnswers = [];
    let questions = [];

    // ç”Ÿæˆç•¶æ—¥é¡Œç›®
    function generateDailyQuestions(dateStr) {
      const seed = dateStr.split('-').join('');
      let random = parseInt(seed);
      
      function seededRandom() {
        random = (random * 9301 + 49297) % 233280;
        return random / 233280;
      }

      const qs = [];
      
      // 2é¡Œæ•´æ•¸ (1-2ä½æ•¸,ç¢ºä¿èƒ½ç´„åˆ†)
      for (let i = 0; i < 2; i++) {
        // å…ˆç”Ÿæˆæœ€ç°¡æ•´æ•¸æ¯” (1-9çš„æ•¸å­—)
        const a = Math.floor(seededRandom() * 9) + 1;
        const b = Math.floor(seededRandom() * 9) + 1;
        // å…¬å› æ•¸ (2-9)
        const gcdValue = Math.floor(seededRandom() * 8) + 2;
        
        let num1 = a * gcdValue;
        let num2 = b * gcdValue;
        
        // ç¢ºä¿æ˜¯1-2ä½æ•¸ (æœ€å¤§99)
        if (num1 > 99) num1 = (Math.floor(seededRandom() * 9) + 1) * gcdValue;
        if (num2 > 99) num2 = (Math.floor(seededRandom() * 9) + 1) * gcdValue;
        
        qs.push({
          type: 'æ•´æ•¸',
          display: `${num1} : ${num2}`,
          answer: [a, b]
        });
      }
      
      // 2é¡Œå°æ•¸ (åŒ–æˆæ•´æ•¸å¾Œæ˜¯1-2ä½æ•¸,ç¢ºä¿èƒ½ç´„åˆ†)
      for (let i = 0; i < 2; i++) {
        // å…ˆç”Ÿæˆæœ€ç°¡æ•´æ•¸æ¯” (1-9çš„æ•¸å­—)
        const a = Math.floor(seededRandom() * 9) + 1;
        const b = Math.floor(seededRandom() * 9) + 1;
        // å…¬å› æ•¸ (2-9)
        const gcdValue = Math.floor(seededRandom() * 8) + 2;
        
        // æ•´æ•¸éƒ¨åˆ†ä¹˜ä»¥å…¬å› æ•¸ (ç¢ºä¿1-2ä½æ•¸)
        let num1 = a * gcdValue;
        let num2 = b * gcdValue;
        
        // ç¢ºä¿æ˜¯1-2ä½æ•¸
        if (num1 > 99) num1 = (Math.floor(seededRandom() * 9) + 1) * gcdValue;
        if (num2 > 99) num2 = (Math.floor(seededRandom() * 9) + 1) * gcdValue;
        
        // æ±ºå®šå°æ•¸ä½æ•¸ (1-2ä½)
        const digits1 = Math.floor(seededRandom() * 2) + 1;
        const digits2 = Math.floor(seededRandom() * 2) + 1;
        const maxDigits = Math.max(digits1, digits2);
        
        // è½‰æ›æˆå°æ•¸é¡¯ç¤º
        let dec1, dec2;
        if (digits1 === 1) {
          dec1 = (num1 / 10).toFixed(1);
        } else {
          dec1 = (num1 / 100).toFixed(2);
        }
        
        if (digits2 === 1) {
          dec2 = (num2 / 10).toFixed(1);
        } else {
          dec2 = (num2 / 100).toFixed(2);
        }
        
        // è¨ˆç®—åŒ–æˆæ•´æ•¸å¾Œçš„å€¼
        const multiplier = Math.pow(10, maxDigits);
        let intNum1 = num1;
        let intNum2 = num2;
        
        if (digits1 < maxDigits) intNum1 *= Math.pow(10, maxDigits - digits1);
        if (digits2 < maxDigits) intNum2 *= Math.pow(10, maxDigits - digits2);
        
        const g = gcd(intNum1, intNum2);
        
        qs.push({
          type: 'å°æ•¸',
          display: `${dec1} : ${dec2}`,
          answer: [intNum1 / g, intNum2 / g]
        });
      }
      
      // 2é¡Œåˆ†æ•¸ (åŒ…å«çœŸåˆ†æ•¸ã€å‡åˆ†æ•¸ã€å¸¶åˆ†æ•¸)
      for (let i = 0; i < 2; i++) {
        const useMixed = seededRandom() > 0.6; // 40%æ©Ÿç‡ä½¿ç”¨å¸¶åˆ†æ•¸
        
        let n1, d1, n2, d2;
        let frac1Display, frac2Display;
        
        // ç¬¬ä¸€å€‹åˆ†æ•¸
        if (useMixed && seededRandom() > 0.5) {
          const whole = Math.floor(seededRandom() * 3) + 1;
          const numerator = Math.floor(seededRandom() * 4) + 1;
          d1 = Math.floor(seededRandom() * 5) + 2;
          n1 = whole * d1 + numerator;
          frac1Display = { type: 'mixed', whole, numerator, denominator: d1 };
        } else {
          d1 = Math.floor(seededRandom() * 8) + 2;
          n1 = Math.floor(seededRandom() * 12) + 1;
          frac1Display = { type: 'simple', numerator: n1, denominator: d1 };
        }
        
        // ç¬¬äºŒå€‹åˆ†æ•¸
        if (useMixed && seededRandom() > 0.5) {
          const whole = Math.floor(seededRandom() * 3) + 1;
          const numerator = Math.floor(seededRandom() * 4) + 1;
          d2 = Math.floor(seededRandom() * 5) + 2;
          n2 = whole * d2 + numerator;
          frac2Display = { type: 'mixed', whole, numerator, denominator: d2 };
        } else {
          d2 = Math.floor(seededRandom() * 8) + 2;
          n2 = Math.floor(seededRandom() * 12) + 1;
          frac2Display = { type: 'simple', numerator: n2, denominator: d2 };
        }
        
        const ansNum = n1 * d2;
        const ansDen = n2 * d1;
        const g = gcd(ansNum, ansDen);
        
        qs.push({
          type: 'åˆ†æ•¸',
          frac1: frac1Display,
          frac2: frac2Display,
          answer: [ansNum / g, ansDen / g]
        });
      }
      
      return qs;
    }

    function gcd(a, b) {
      a = Math.abs(Math.round(a));
      b = Math.abs(Math.round(b));
      while (b !== 0) {
        const temp = b;
        b = a % b;
        a = temp;
      }
      return a;
    }

    function getTodayDate() {
      const today = new Date();
      return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    }

    function showQuestion() {
      if (currentQuestion < questions.length) {
        const q = questions[currentQuestion];
        const questionText = document.getElementById('question-text');
        questionText.innerHTML = '';
        
        const title = document.createElement('div');
        title.textContent = 'è«‹å°‡ä¸‹åˆ—æ¯”åŒ–ç‚ºæœ€ç°¡å–®æ•´æ•¸æ¯”:';
        title.style.marginBottom = '20px';
        questionText.appendChild(title);
        
        if (q.type === 'åˆ†æ•¸') {
          const fractionContainer = document.createElement('div');
          fractionContainer.style.display = 'flex';
          fractionContainer.style.alignItems = 'center';
          fractionContainer.style.justifyContent = 'center';
          fractionContainer.style.gap = '30px';
          fractionContainer.style.fontSize = '2rem';
          
          // ç¬¬ä¸€å€‹åˆ†æ•¸
          const frac1 = createFractionDisplay(q.frac1);
          fractionContainer.appendChild(frac1);
          
          // å†’è™Ÿ
          const colon = document.createElement('span');
          colon.textContent = ':';
          colon.style.fontSize = '2.5rem';
          colon.style.fontWeight = 'bold';
          fractionContainer.appendChild(colon);
          
          // ç¬¬äºŒå€‹åˆ†æ•¸
          const frac2 = createFractionDisplay(q.frac2);
          fractionContainer.appendChild(frac2);
          
          questionText.appendChild(fractionContainer);
        } else {
          const display = document.createElement('div');
          display.textContent = q.display;
          display.style.fontSize = '2rem';
          display.style.textAlign = 'center';
          display.style.marginTop = '10px';
          questionText.appendChild(display);
        }
        
        document.getElementById('progress-text').textContent = `ç¬¬ ${currentQuestion + 1} é¡Œ / å…± 6 é¡Œ`;
        document.getElementById('progress-bar').style.width = `${((currentQuestion + 1) / 6) * 100}%`;
        document.getElementById('answer1').value = '';
        document.getElementById('answer2').value = '';
        document.getElementById('answer1').focus();
      }
    }
    
    function createFractionDisplay(frac) {
      const container = document.createElement('div');
      container.style.display = 'inline-flex';
      container.style.alignItems = 'center';
      container.style.gap = '8px';
      
      if (frac.type === 'mixed') {
        // å¸¶åˆ†æ•¸
        const whole = document.createElement('span');
        whole.textContent = frac.whole;
        whole.style.fontSize = '2rem';
        whole.style.fontWeight = 'bold';
        container.appendChild(whole);
        
        const fracPart = document.createElement('div');
        fracPart.style.display = 'inline-flex';
        fracPart.style.flexDirection = 'column';
        fracPart.style.alignItems = 'center';
        
        const num = document.createElement('div');
        num.textContent = frac.numerator;
        num.style.borderBottom = '2px solid currentColor';
        num.style.paddingBottom = '2px';
        fracPart.appendChild(num);
        
        const den = document.createElement('div');
        den.textContent = frac.denominator;
        den.style.paddingTop = '2px';
        fracPart.appendChild(den);
        
        container.appendChild(fracPart);
      } else {
        // çœŸåˆ†æ•¸æˆ–å‡åˆ†æ•¸
        const fracPart = document.createElement('div');
        fracPart.style.display = 'inline-flex';
        fracPart.style.flexDirection = 'column';
        fracPart.style.alignItems = 'center';
        
        const num = document.createElement('div');
        num.textContent = frac.numerator;
        num.style.borderBottom = '2px solid currentColor';
        num.style.paddingBottom = '2px';
        num.style.fontSize = '1.5rem';
        fracPart.appendChild(num);
        
        const den = document.createElement('div');
        den.textContent = frac.denominator;
        den.style.paddingTop = '2px';
        den.style.fontSize = '1.5rem';
        fracPart.appendChild(den);
        
        container.appendChild(fracPart);
      }
      
      return container;
    }

    function checkAnswers() {
      let score = 0;
      const results = questions.map((q, i) => {
        const userAns = userAnswers[i];
        const g = gcd(userAns[0], userAns[1]);
        const simplified = [userAns[0] / g, userAns[1] / g];
        const isCorrect = simplified[0] === q.answer[0] && simplified[1] === q.answer[1];
        if (isCorrect) score++;
        
        const result = {
          type: q.type,
          userAnswer: `${userAns[0]} : ${userAns[1]}`,
          correctAnswer: `${q.answer[0]} : ${q.answer[1]}`,
          isCorrect,
          solution: generateSolution(q, i)
        };
        
        if (q.type === 'åˆ†æ•¸') {
          result.frac1 = q.frac1;
          result.frac2 = q.frac2;
        } else {
          result.question = q.display;
        }
        
        return result;
      });
      return { score, results };
    }
    
    function generateSolution(q, index) {
      const solution = [];
      
      if (q.type === 'æ•´æ•¸') {
        const parts = q.display.split(' : ');
        const num1 = parseInt(parts[0]);
        const num2 = parseInt(parts[1]);
        const gcdValue = gcd(num1, num2);
        
        solution.push(`æ­¥é©Ÿ1: åŸå¼ = ${num1} : ${num2}`);
        solution.push(`æ­¥é©Ÿ2: æ‰¾å‡º ${num1} å’Œ ${num2} çš„æœ€å¤§å…¬å› æ•¸`);
        
        // åˆ—å‡ºå› æ•¸
        const factors1 = [];
        const factors2 = [];
        for (let i = 1; i <= num1; i++) {
          if (num1 % i === 0) factors1.push(i);
        }
        for (let i = 1; i <= num2; i++) {
          if (num2 % i === 0) factors2.push(i);
        }
        solution.push(`       ${num1} çš„å› æ•¸: ${factors1.join(', ')}`);
        solution.push(`       ${num2} çš„å› æ•¸: ${factors2.join(', ')}`);
        solution.push(`       æœ€å¤§å…¬å› æ•¸ = ${gcdValue}`);
        solution.push(`æ­¥é©Ÿ3: åŒé™¤ä»¥æœ€å¤§å…¬å› æ•¸ ${gcdValue}`);
        solution.push(`       ${num1} Ã· ${gcdValue} = ${q.answer[0]}`);
        solution.push(`       ${num2} Ã· ${gcdValue} = ${q.answer[1]}`);
        solution.push(`âœ“ ç­”æ¡ˆ: ${q.answer[0]} : ${q.answer[1]}`);
        
      } else if (q.type === 'å°æ•¸') {
        const parts = q.display.split(' : ');
        const dec1 = parts[0];
        const dec2 = parts[1];
        
        // è¨ˆç®—å°æ•¸ä½æ•¸
        const digits1 = dec1.includes('.') ? dec1.split('.')[1].length : 0;
        const digits2 = dec2.includes('.') ? dec2.split('.')[1].length : 0;
        const maxDigits = Math.max(digits1, digits2);
        const multiplier = Math.pow(10, maxDigits);
        
        solution.push(`æ­¥é©Ÿ1: åŸå¼ = ${dec1} : ${dec2}`);
        solution.push(`æ­¥é©Ÿ2: å°‡å°æ•¸åŒ–ç‚ºæ•´æ•¸ (åŒä¹˜ä»¥ ${multiplier})`);
        
        const int1 = parseFloat(dec1) * multiplier;
        const int2 = parseFloat(dec2) * multiplier;
        
        solution.push(`       ${dec1} Ã— ${multiplier} = ${int1}`);
        solution.push(`       ${dec2} Ã— ${multiplier} = ${int2}`);
        solution.push(`       å¾—åˆ° ${int1} : ${int2}`);
        
        const gcdValue = gcd(int1, int2);
        solution.push(`æ­¥é©Ÿ3: æ‰¾å‡º ${int1} å’Œ ${int2} çš„æœ€å¤§å…¬å› æ•¸ = ${gcdValue}`);
        solution.push(`æ­¥é©Ÿ4: åŒé™¤ä»¥æœ€å¤§å…¬å› æ•¸ ${gcdValue}`);
        solution.push(`       ${int1} Ã· ${gcdValue} = ${q.answer[0]}`);
        solution.push(`       ${int2} Ã· ${gcdValue} = ${q.answer[1]}`);
        solution.push(`âœ“ ç­”æ¡ˆ: ${q.answer[0]} : ${q.answer[1]}`);
        
      } else if (q.type === 'åˆ†æ•¸') {
        solution.push(`æ­¥é©Ÿ1: å°‡åˆ†æ•¸æ¯”åŒ–ç‚ºæ•´æ•¸æ¯”`);
        
        // è½‰æ›ç¬¬ä¸€å€‹åˆ†æ•¸
        let n1, d1;
        if (q.frac1.type === 'mixed') {
          n1 = q.frac1.whole * q.frac1.denominator + q.frac1.numerator;
          d1 = q.frac1.denominator;
          solution.push(`       ${q.frac1.whole} åˆ ${q.frac1.numerator}/${q.frac1.denominator} = ${n1}/${d1}`);
        } else {
          n1 = q.frac1.numerator;
          d1 = q.frac1.denominator;
          solution.push(`       ç¬¬ä¸€å€‹åˆ†æ•¸ = ${n1}/${d1}`);
        }
        
        // è½‰æ›ç¬¬äºŒå€‹åˆ†æ•¸
        let n2, d2;
        if (q.frac2.type === 'mixed') {
          n2 = q.frac2.whole * q.frac2.denominator + q.frac2.numerator;
          d2 = q.frac2.denominator;
          solution.push(`       ${q.frac2.whole} åˆ ${q.frac2.numerator}/${q.frac2.denominator} = ${n2}/${d2}`);
        } else {
          n2 = q.frac2.numerator;
          d2 = q.frac2.denominator;
          solution.push(`       ç¬¬äºŒå€‹åˆ†æ•¸ = ${n2}/${d2}`);
        }
        
        solution.push(`æ­¥é©Ÿ2: ${n1}/${d1} : ${n2}/${d2} = ${n1} Ã— ${d2} : ${n2} Ã— ${d1}`);
        
        const num1 = n1 * d2;
        const num2 = n2 * d1;
        
        solution.push(`       = ${num1} : ${num2}`);
        
        const gcdValue = gcd(num1, num2);
        solution.push(`æ­¥é©Ÿ3: æ‰¾å‡º ${num1} å’Œ ${num2} çš„æœ€å¤§å…¬å› æ•¸ = ${gcdValue}`);
        solution.push(`æ­¥é©Ÿ4: åŒé™¤ä»¥æœ€å¤§å…¬å› æ•¸ ${gcdValue}`);
        solution.push(`       ${num1} Ã· ${gcdValue} = ${q.answer[0]}`);
        solution.push(`       ${num2} Ã· ${gcdValue} = ${q.answer[1]}`);
        solution.push(`âœ“ ç­”æ¡ˆ: ${q.answer[0]} : ${q.answer[1]}`);
      }
      
      return solution;
    }

    function showResults() {
      const { score, results } = checkAnswers();
      document.getElementById('question-page').classList.add('hidden');
      document.getElementById('result-page').classList.remove('hidden');
      document.getElementById('score-display').textContent = `${score} / 6`;
      
      const reviewContainer = document.getElementById('answers-review');
      reviewContainer.innerHTML = '';
      
      results.forEach((r, i) => {
        const resultCard = document.createElement('div');
        resultCard.className = `p-4 rounded-lg border-2 ${r.isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
        
        const header = document.createElement('div');
        header.className = 'flex items-start justify-between mb-2';
        header.innerHTML = `
          <span class="font-semibold">ç¬¬ ${i + 1} é¡Œ (${r.type})</span>
          <span class="text-xl">${r.isCorrect ? 'âœ“' : 'âœ—'}</span>
        `;
        resultCard.appendChild(header);
        
        if (r.type === 'åˆ†æ•¸') {
          const questionLabel = document.createElement('p');
          questionLabel.textContent = 'é¡Œç›®:';
          questionLabel.className = 'mb-2 font-semibold';
          resultCard.appendChild(questionLabel);
          
          const questionDisplay = document.createElement('div');
          questionDisplay.style.display = 'flex';
          questionDisplay.style.alignItems = 'center';
          questionDisplay.style.gap = '15px';
          questionDisplay.style.marginBottom = '10px';
          questionDisplay.style.fontSize = '1.2rem';
          
          const frac1 = createFractionDisplay(r.frac1);
          questionDisplay.appendChild(frac1);
          
          const colon1 = document.createElement('span');
          colon1.textContent = ':';
          colon1.style.fontSize = '1.5rem';
          questionDisplay.appendChild(colon1);
          
          const frac2 = createFractionDisplay(r.frac2);
          questionDisplay.appendChild(frac2);
          
          resultCard.appendChild(questionDisplay);
        } else {
          const questionP = document.createElement('p');
          questionP.textContent = `é¡Œç›®: ${r.question}`;
          questionP.className = 'mb-2';
          resultCard.appendChild(questionP);
        }
        
        const userAnswerP = document.createElement('p');
        userAnswerP.textContent = `ä½ çš„ç­”æ¡ˆ: ${r.userAnswer}`;
        userAnswerP.className = 'mb-2';
        resultCard.appendChild(userAnswerP);
        
        if (!r.isCorrect) {
          const correctAnswerP = document.createElement('p');
          correctAnswerP.textContent = `æ­£ç¢ºç­”æ¡ˆ: ${r.correctAnswer}`;
          correctAnswerP.className = 'text-red-600 font-semibold mb-2';
          resultCard.appendChild(correctAnswerP);
        }
        
        // åŠ å…¥è§£é¡Œéç¨‹
        const solutionTitle = document.createElement('p');
        solutionTitle.textContent = 'ğŸ“ è§£é¡Œéç¨‹:';
        solutionTitle.className = 'font-semibold mt-3 mb-2';
        resultCard.appendChild(solutionTitle);
        
        const solutionBox = document.createElement('div');
        solutionBox.className = 'bg-white bg-opacity-50 p-3 rounded text-sm space-y-1';
        
        if (r.solution) {
          r.solution.forEach(step => {
            const stepP = document.createElement('p');
            stepP.textContent = step;
            solutionBox.appendChild(stepP);
          });
        }
        
        resultCard.appendChild(solutionBox);
        
        reviewContainer.appendChild(resultCard);
      });
      
      saveResult(score);
    }

    async function saveResult(score) {
      const result = await window.dataSdk.create({
        id: `${getTodayDate()}-${studentInfo.grade}-${studentInfo.classNumber}-${studentInfo.seatNumber}-${Date.now()}`,
        date: getTodayDate(),
        grade: studentInfo.grade,
        class_number: studentInfo.classNumber,
        seat_number: studentInfo.seatNumber,
        answers: JSON.stringify(userAnswers),
        score: score,
        completed_at: new Date().toISOString()
      });
    }

    function applyStyles() {
      const baseFont = config.font_size || defaultConfig.font_size;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      document.body.style.background = config.background_color || defaultConfig.background_color;
      document.body.style.color = config.text_color || defaultConfig.text_color;
      document.body.style.fontFamily = `${fontFamily}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseFont}px`;
      
      const surfaces = [document.getElementById('info-page'), document.getElementById('question-page'), document.getElementById('result-page')];
      surfaces.forEach(el => {
        if (el) {
          el.style.background = config.surface_color || defaultConfig.surface_color;
          el.style.color = config.text_color || defaultConfig.text_color;
        }
      });
      
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('app-title').style.fontSize = `${baseFont * 2}px`;
      document.getElementById('app-title').style.color = config.text_color || defaultConfig.text_color;
      
      const dateDisplay = document.getElementById('date-display');
      dateDisplay.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
      dateDisplay.style.color = config.surface_color || defaultConfig.surface_color;
      dateDisplay.style.fontSize = `${baseFont * 1.25}px`;
      
      const gradeLabel = document.getElementById('grade-label');
      gradeLabel.querySelector('span:last-child').textContent = config.grade_label || defaultConfig.grade_label;
      
      const classLabel = document.getElementById('class-label');
      classLabel.querySelector('span:last-child').textContent = config.class_label || defaultConfig.class_label;
      
      const seatLabel = document.getElementById('seat-label');
      seatLabel.querySelector('span:last-child').textContent = config.seat_label || defaultConfig.seat_label;
      
      const labels = document.querySelectorAll('label');
      labels.forEach(label => {
        label.style.color = config.text_color || defaultConfig.text_color;
        label.style.fontSize = `${baseFont * 1.125}px`;
      });
      
      const inputs = document.querySelectorAll('input');
      inputs.forEach(input => {
        input.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
        input.style.color = config.text_color || defaultConfig.text_color;
        input.style.fontSize = `${baseFont * 1.125}px`;
      });
      
      const startBtn = document.getElementById('start-btn');
      startBtn.querySelector('span:last-child').textContent = config.button_text || defaultConfig.button_text;
      startBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      startBtn.style.color = config.surface_color || defaultConfig.surface_color;
      startBtn.style.fontSize = `${baseFont * 1.25}px`;
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      submitBtn.style.color = config.surface_color || defaultConfig.surface_color;
      submitBtn.style.fontSize = `${baseFont * 1.25}px`;
      
      const restartBtn = document.getElementById('restart-btn');
      restartBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      restartBtn.style.color = config.surface_color || defaultConfig.surface_color;
      restartBtn.style.fontSize = `${baseFont * 1.25}px`;
      
      const progressBar = document.getElementById('progress-bar');
      progressBar.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      
      const questionContainer = document.getElementById('question-container');
      questionContainer.style.background = config.surface_color || defaultConfig.surface_color;
      questionContainer.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      
      document.getElementById('question-text').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('question-text').style.fontSize = `${baseFont * 1.5}px`;
    }

    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      applyStyles();
    }

    const dataHandler = {
      onDataChanged(data) {
        // è³‡æ–™è®Šæ›´æ™‚ä¸éœ€è¦æ›´æ–°UI
      }
    };

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      if (window.dataSdk) {
        await window.dataSdk.init(dataHandler);
      }
      
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (cfg) => ({
            recolorables: [
              { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); } },
              { get: () => cfg.surface_color || defaultConfig.surface_color, set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); } },
              { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); } },
              { get: () => cfg.primary_action_color || defaultConfig.primary_action_color, set: (v) => { cfg.primary_action_color = v; window.elementSdk.setConfig({ primary_action_color: v }); } },
              { get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color, set: (v) => { cfg.secondary_action_color = v; window.elementSdk.setConfig({ secondary_action_color: v }); } }
            ],
            borderables: [],
            fontEditable: { get: () => cfg.font_family || defaultConfig.font_family, set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); } },
            fontSizeable: { get: () => cfg.font_size || defaultConfig.font_size, set: (v) => { cfg.font_size = v; window.elementSdk.setConfig({ font_size: v }); } }
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ["app_title", cfg.app_title || defaultConfig.app_title],
            ["date_label", cfg.date_label || defaultConfig.date_label],
            ["grade_label", cfg.grade_label || defaultConfig.grade_label],
            ["class_label", cfg.class_label || defaultConfig.class_label],
            ["seat_label", cfg.seat_label || defaultConfig.seat_label],
            ["button_text", cfg.button_text || defaultConfig.button_text]
          ])
        });
        config = window.elementSdk.config;
      }
      
      const todayDate = getTodayDate();
      document.getElementById('date-display').textContent = `${config.date_label || defaultConfig.date_label}: ${todayDate}`;
      questions = generateDailyQuestions(todayDate);
      
      applyStyles();
      
      document.getElementById('start-btn').addEventListener('click', (e) => {
        e.preventDefault();
        const grade = parseInt(document.getElementById('grade-input').value);
        const classNum = parseInt(document.getElementById('class-input').value);
        const seatNum = parseInt(document.getElementById('seat-input').value);
        
        if (!grade || !classNum || !seatNum) {
          const msg = document.createElement('p');
          msg.textContent = 'è«‹å¡«å¯«å®Œæ•´è³‡è¨Š';
          msg.className = 'text-red-500 text-center mt-4 font-semibold';
          msg.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
          document.getElementById('info-page').appendChild(msg);
          setTimeout(() => msg.remove(), 2000);
          return;
        }
        
        studentInfo = { grade, classNumber: classNum, seatNumber: seatNum };
        document.getElementById('student-info-text').textContent = `${grade}å¹´${classNum}ç­${seatNum}è™Ÿ`;
        document.getElementById('info-page').classList.add('hidden');
        document.getElementById('question-page').classList.remove('hidden');
        showQuestion();
      });
      
      document.getElementById('submit-btn').addEventListener('click', (e) => {
        e.preventDefault();
        const ans1 = parseInt(document.getElementById('answer1').value);
        const ans2 = parseInt(document.getElementById('answer2').value);
        
        if (!ans1 || !ans2 || ans1 <= 0 || ans2 <= 0) {
          const msg = document.createElement('p');
          msg.textContent = 'è«‹è¼¸å…¥æ­£ç¢ºçš„ç­”æ¡ˆ';
          msg.className = 'text-red-500 text-center mt-4 font-semibold';
          msg.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
          document.getElementById('question-page').appendChild(msg);
          setTimeout(() => msg.remove(), 2000);
          return;
        }
        
        userAnswers.push([ans1, ans2]);
        currentQuestion++;
        
        if (currentQuestion < 6) {
          showQuestion();
        } else {
          showResults();
        }
      });
      
      document.getElementById('restart-btn').addEventListener('click', (e) => {
        e.preventDefault();
        currentQuestion = 0;
        userAnswers = [];
        studentInfo = {};
        document.getElementById('grade-input').value = '';
        document.getElementById('class-input').value = '';
        document.getElementById('seat-input').value = '';
        document.getElementById('result-page').classList.add('hidden');
        document.getElementById('info-page').classList.remove('hidden');
      });
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99d69c3b27c84a15',t:'MTc2Mjk1NjYwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>